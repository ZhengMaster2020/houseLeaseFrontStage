<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>小麦网房屋详情页</title>
	<link rel="stylesheet" type="text/css" href="css/detail.css">
	<!-- 首页轮播图样式 -->
	<link type="text/css" href="css/slider-pro.css" rel="stylesheet">  
	<link type="text/css" href="css/htmleaf-demo.css" rel="stylesheet">  
	<link type="text/css" href="css/examples.css" rel="stylesheet">  
	<link type="text/css" href="css/normalize.css" rel="stylesheet">  
	<link type="text/css" href="fancybox/jquery.fancybox.css" rel="stylesheet"> 
	<!-- 首页菜单栏选项卡样式 -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootsnav.css">
	<!-- font-awesome.css为菜单栏选项卡倒三角下标，需引用官网的样式 -->
	<link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
	<!-- 房东卡片的小图标i 不知道为啥一定要放在assets里面，奇葩 -->
	<link href="assets/fonts/icon-7-stroke/css/pe-icon-7-stroke.css" rel="stylesheet">
	<!-- 首页菜单栏选项卡JS -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
	<!-- 首页轮播图JS -->
	<script type="text/javascript" src="fancybox/jquery.fancybox.js"></script>
	<!-- 详细页的轮播图与首页轮播图有default宽度长度的区别 -->
	<script type="text/javascript" src="js/jquery.sliderPro01.js"></script>
	<!-- 百度地图JS插件 -->
		<!-- 接口js地址 -->
	<script type="text/javascript" src="http://api.map.baidu.com/api?key=&v=1.1&services=true"></script>

	<script type="text/javascript" src="js/baidumap.js"></script>
	<script src="./js/business/login.js"></script>
	
</head>
<body>
	<div class="top">  <!-- 图标  字体  小控件 -->
	<!-- 头部 -->

		<div class="top_left">
		<a href="index.html">
			<img alt="logo" src="pic/logo.png">
		</a>
		</div>

		<div class="qa-search-wrap-left">
		<!-- 顶部搜索框 -->
            <form class="comp-Searcher" id="qaNavSearcherForm" type="post" action="#">
    		<div class="ipt-wrap">
        		<input class="ipt" id="qaNavSearcherIpt" type="text" placeholder="在这儿输入您的问题">
    		</div>
    		<button class="right-icon" type="submit">
    			<i class="iconfont">搜&nbsp;&nbsp;索</i>
    		</button>
			</form>
        </div>

		<div class="top_right">
			<ul class="ul_son">
				<li class="login" onclick="login()"><a id="login" href="./login.html">登&nbsp;&nbsp;&nbsp;&nbsp;录</a></li>
				<li class="registry" onclick="registry()"><a id="registry" href="./register.html">注&nbsp;&nbsp;&nbsp;&nbsp;册</a></li>
				<li class="userinfo"><a id="userinfo" style="display: none;" href="#">用户名</a></li>
				<li class="exit" onclick="logout()"><a id="exit" style="display: none;">注&nbsp;&nbsp;&nbsp;&nbsp;销</a></li>
			</ul>
		</div>
		<hr />	<!-- 分割线 -->
	</div>

	<!-- 菜单导航栏，支持下拉 -->
	<div class="container">
    <div class="row">
        <div class="col-md-12">
            <nav class="navbar navbar-default navbar-mobile bootsnav on">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
                <div class="collapse navbar-collapse" id="navbar-menu">
                    <ul class="nav navbar-nav" data-in="fadeInDown" data-out="fadeOutUp">
                    	<!-- Slide 1 -->
                        <li><a href="index.html" data-hover="Home">首页</a></li>
                    	<!-- Slide 2 -->
                        <li><a href="index.html#newPublish" data-hover="About">新房发布</a></li>
                        <!-- Slide 3 -->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="Shortcodes">地区选择</a>
                            <ul class="dropdown-menu animated">
                                <li><a href="area.html">全部（不限）</a></li>
                                <li><a href="area.html">增城</a></li>
                                <li><a href="area.html">番禺</a></li>
                                <li><a href="area.html">南沙</a></li>
                                <li><a href="area.html">花都</a></li>
                                <li><a href="area.html">白云</a></li>
                                <li><a href="area.html">海珠</a></li>
                                <li><a href="area.html">越秀</a></li>
                                <li><a href="area.html">荔湾</a></li>
                                <li><a href="area.html">天河</a></li>
                                <li><a href="area.html">从化</a></li>
                                <li><a href="area.html">黄埔</a></li>
                                <!-- <li><a href="area.html">广州周边</a></li> -->
                            </ul>
                        </li>
                        <!-- Slide 4 -->
                        <!-- <li><a href="recommend.html" data-hover="Contact">爆款推荐</a></li> -->
                        <!-- Slide 5 -->
                        <li><a href="search.html" data-hover="Portfolio">房屋搜索</a></li>
                        <!-- Slide 7 -->
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="Pages">更多</a>
                            <ul class="dropdown-menu animated">
                                <li><a href="personal-infor.html">个人中心</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
</div>
	
	<!-- 中间横幅字体+背景图 -->
	<div class="page-head">
		<div class="page-head-content">
			<h1 class="page-title">新房子推荐，给你超棒服务的大平台~</h1>
		</div>
	</div>

	<div class="main-contents">
		<div class="main-content">
			<!-- 轮播图 -->
			<div id="example3" class="slider-pro">
				<div class="slider-pro" id="my-slider">
				  <div id="houseImg" class="sp-slides">
				  	<!-- 轮播图主体上部 -->
					    <div class="sp-slide">
								<img class="sp-image sp0" src="pic/a - 副本.jpg"/>
							</div> 
							<div class="sp-slide">
								<img class="sp-image sp1" src="pic/b - 副本.jpg"/>
							</div>
							<div class="sp-slide">
								<img class="sp-image sp2" src="pic/c - 副本.jpg"/>
							</div>
							<div class="sp-slide">
								<img class="sp-image sp3" src="pic/d - 副本.jpg"/>
							</div>
							<div class="sp-slide">
								<img class="sp-image sp4" src="pic/e - 副本.jpg"/>
							</div>	
							<div class="sp-slide">
								<img class="sp-image sp5" src="pic/f - 副本.jpg"/>
							</div>
							<div class="sp-slide">
								<img class="sp-image sp6" src="pic/1 - 副本.jpg"/>
					    </div>
				  </div>
				  <div id="imgWrap" class="sp-thumbnails">
					<!-- 轮播图主体下部 -->
					<img class="sp-thumbnail img0" src="pic/a - 副本.jpg"/>
					<img class="sp-thumbnail img1" src="pic/b - 副本.jpg"/>
					<img class="sp-thumbnail img2" src="pic/c - 副本.jpg"/>
					<img class="sp-thumbnail img3" src="pic/d - 副本.jpg"/>
					<img class="sp-thumbnail img4" src="pic/e - 副本.jpg"/>
					<img class="sp-thumbnail img5" src="pic/f - 副本.jpg"/>
					<img class="sp-thumbnail img6" src="pic/1 - 副本.jpg"/>
					</div>
				</div>

			</div>
		</div>

		<div class="house-Infor">
			<!-- 轮播图右侧房屋信息卡片 -->
			<div class="house-Infor-title">
				<h1 id="houseTitle" class="house-Infor-h1">黄埔区府 大沙地 荔园小区 采光好 拎包入住</h1>
				<span id="housePrice" class="house-Infor-price">¥2500</span>
			</div>
			<!-- 房屋详情小图标和文字 -->
			<div class="property-meta clearfix ">   
                <div class="col-xs-4 col-sm-4 col-md-4 p-b-15">
                    <span class="property-info-icon">
                        <img src="pic/icon/sale-orange.png">
                    </span>
                    <span class="property-info-entry">
                        <span class="property-info-label">状态</span>
                        <span id="houseStatus" class="property-info-value">出售/出租</span>
                    </span>
                </div>

                <div class="col-xs-4 col-sm-4 col-md-4 p-b-15">
                    <span class="property-info">
                        <img src="pic/icon/room-orange.png">
                    </span>
                    <span class="property-info-entry">
                        <span class="property-info-label">面积</span>
                        <span id="houseArea" class="property-info-value">38<b class="property-info-unit">平方米</b></span>
                    </span>
                </div>

                <div class="col-xs-4 col-sm-4 col-md-4 p-b-15">
                    <span class="property-info-icon">
                        <img src="pic/icon/bed-orange.png">
                    </span>
                    <span class="property-info-entry">
                        <span class="property-info-label">房间数</span>
                        <span id="romeNum" class="property-info-value">1</span>
                    </span>
                </div>

                <div class="col-xs-4 col-sm-4 col-md-4 p-b-15">
                    <span class="property-info-icon">
                        <img src="pic/icon/cars-orange.png">
                    </span>
                    <span class="property-info-entry">
                        <span class="property-info-label">客厅数</span>
                        <span id="livingRoomNum" class="property-info-value">1</span>
                    </span>
                </div>
                <div class="col-xs-4 col-sm-4 col-md-4 p-b-15">
                    <span class="property-info-icon">
                        <img src="pic/icon/os-orange.png">
                    </span>
                    <span class="property-info-entry">
                        <span class="property-info-label">厕所</span>
                        <span id="toiletNum" class="property-info-value">1</span>
                    </span>
                </div>

                <div class="col-xs-4 col-sm-4 col-md-4 p-b-15">
                    <span class="property-info-icon">
                        <img src="pic/icon/room-orange.png">
                    </span>
                    <span class="property-info-entry">
                        <span class="property-info-label">租售情况</span>
                        <span id="saleSituation" class="property-info-value">合租/整租</span>
                    </span>
                </div>

                <div class="col-xs-4 col-sm-4 col-md-4 p-b-15">
                    <span class="property-info-icon">
                        <img src="pic/icon/shawer-orange.png">
                    </span>
                    <span class="property-info-entry">
                        <span class="property-info-label">是否有花园</span>
                        <span id="garden" class="property-info-value">否</span>
                    </span>
                </div>
		   </div>

			<div class="owner-Infor">
			<!-- 轮播图右下侧卡片-----title-->
				<span>房东信息</span>
			</div>
			<!-- 轮播图右下侧卡片-----房东信息-->
			<div class="owner-clear owner-clear-height1">
		        <div class="col-xs-4 col-sm-4 dealer-face">
		            <a href="">
		                <img id="lanlordAvatar" src="pic/client-face1.png" class="img-circle" style="width: 88px; height: 88px;">
		            </a>
		        </div>
		        <div class="col-xs-8 col-sm-8 card-sp">
		            <h3 class="dealer-name">
		                <a id="landlordName" href="#" class="p-d-10">黄小明</a><br />
		                <span id="lanlordType" class="p-d-10">一手房东</span>        
		            </h3>
		        </div>
		    </div>
			<!-- 轮播图右下侧卡片-----房东联系方式等-->
			<div class="owner-clear owner-clear-height2">
		        <ul class="dealer-contacts">
		            <li class="p-d-10">
		            	<i class="pe-7s-map-marker strong i"> </i>
		            	 <span id="lanlordAddr" class="sp">&nbsp;&nbsp;房屋地址：广州市越秀区起义路888号</span>
		            </li>
		            <li class="p-d-10">
		            	<i class="pe-7s-mail strong i"> </i>
		            	 <span id="lanlordEmail" class="sp">&nbsp;&nbsp;email@yourcompany.com</span>
		            </li>
		            <li class="p-d-10">
		            	<i class="pe-7s-call strong i"> </i>
		            	<span id="lanlordPhone" class="sp">188 1568 2222</span>
		            </li>
		        </ul>
		        <p id="lanlordDesc" class="card-p p-d-10">
		        	阳光积极，有责任心
		        </p>
		    </div>

	  	</div>
	 </div>

	<div class="second-main-content">
		<!-- 轮播图下方的房屋内容介绍 -->
		<div class="single-property-wrapper">

		    <div class="section">
		        <h4 class="s-property-title">房屋详情</h4>
		        <div class="s-property-content">
		            <p id="houseDesc" class="single-p">
		            1、荔园小区，两房两厅，成熟小区，朝向：南北通透，户型开阔全明绝世好房。<br />
					2、房间清爽干净，客厅宽敞大气，采光极佳，居住环境温馨舒适<br />
					3、好位置，好楼层，闹中取静<br/>
					</p>
		        </div>
		    </div>
		    <!-- End description area  -->

		    <div class="section additional-details">

		        <h4 class="s-property-title">卖&nbsp;&nbsp;点</h4>

		        <ul id="lanlordSelling" class="additional-details-list clearfix"></ul>
		    </div>  
		    <!-- End additional-details area  -->

		    <div class="section property-features">      

		        <h4 class="s-property-title">拥有特点</h4>                            
		        <ul id="houseFeature">
		        </ul>

		    </div>
		    <!-- End features area  --> 
		</div>

		<!-- 房屋地图导航功能 -->
		<div class="google-map ptb-100">
			<div class="container">
				<div class="row">
					<div class="col-12 text-center">
						<h2>地点位置</h2>
						<p>广州市越秀区起义路888号</p>
						<!-- <div id="googleMap"> -->
							<div id="dituContent"></div>
					</div>
				</div>
			</div>
		</div>
	</div>




		<!-- 我要评论 -->
		<div class="ask-content col-xs-6">
			<div class="query-wrap inputer-wrap" id="publishWrap">
				<!-- 评论提交 -->
	        <div class="ipt-mod" id="titleInputer">
	            <h2 class="cell-title">请留下你的评论...<span class="err-tip errTipNode">标题不能为空</span></h2>
	            <div class="ipt-wrap">
	                <input class="ipt-control iptControl iptControlTitle" id="titleInputNode" type="text" placeholder="这里不能留空哦！" maxlength="100" value="">
	            </div>
	        </div>
	        <div onclick="submitComment()" class="submit-wrap">
						<a id="commentBtn" href="javascript:void(0);">提交评论</a>
	        </div>
			</div>
			<div id="noResult" style=" display: flex; color: #999; justify-content: center;">尚未有评论，点击上方留下您的评论吧</div>
			<div id="commentWrap" class="pinglun_content">
				<!-- 评论内容 -->
			</div>
			<div id="pagination" class="multi-page-wrap">
				<!-- 评论分页 -->
					<div class="multi-page">
						<span>共 5 条</span>        
						<i class="iPre">上一页</i>
						<i class="curr">1</i>
						<i class="iNxt">下一页 &gt;</i>
					</div>
			</div>
		</div>
	


<!-- 页尾 -->
<div class="footer-area">
    <div class=" footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-6 wow fadeInRight animated animated" style="visibility: visible; animation-name: fadeInRight;">
                    <div class="single-footer">
                        <h4>关于我们 </h4>
                        <div class="footer-title-line"></div>
                        <img src="pic/logo.png" alt="" class="wow pulse animated" data-wow-delay="1s" style="visibility: visible; animation-delay: 1s; animation-name: pulse;">
                        <p>良心企业 良心企业 良心企业 良心企业 良心企业 良心企业 良心企业 良心企业 </p>
                        <ul class="footer-adress">
                            <li><i class="pe-7s-map-marker strong"> </i>广东省广州市xxx区</li>
                            <li><i class="pe-7s-mail strong"> </i> email@yourcompany.com</li>
                            <li><i class="pe-7s-call strong"> </i> +1 888 967 8888</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 wow fadeInRight animated animated" style="visibility: visible; animation-name: fadeInRight;">
                    <div class="single-footer">
                        <h4>快速导航 </h4>
                        <div class="footer-title-line"></div>
                        <ul class="footer-menu">
                            <li><a href="#">新房发布</a>  </li> 
                            <li><a href="area.html">地区选择--天河区</a>  </li> 
                            <li><a href="#">联系我们 </a></li> 
                            <li><a href="#">房屋搜索</a></li> 
                            <li><a href="personal-infor.html">个人中心</a>  </li> 
                            <li><a href="#">我的收藏 </a>  </li> 
                        </ul>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 wow fadeInRight animated animated" style="visibility: visible; animation-name: fadeInRight;">
                    <div class="single-footer">
                        <h4>最新发布</h4>
                        <div class="footer-title-line"></div>
                        <ul class="footer-blog">
                            <li>
                                <div class="col-md-4 col-sm-4 col-xs-4 blg-thumb p0">
                                    <a href="detail.html">
                                        <img src="pic/small-pic.jpg">
                                    </a>
                                    <span class="blg-date">12-12-2019</span>

                                </div>
                                <div class="col-md-8  col-sm-8 col-xs-8  blg-entry">
                                    <h6> <a href="detail.html">番禺区笋盘 </a></h6> 
                                    <p style="line-height: 17px; padding: 8px 2px;">棒棒哒的房子 棒棒哒</p>
                                </div>
                            </li> 

                            <li>
                                <div class="col-md-4 col-sm-4 col-xs-4 blg-thumb p0">
                                    <a href="detail.html">
                                        <img src="pic/small-pic.jpg">
                                    </a>
                                    <span class="blg-date">12-12-2019</span>

                                </div>
                                <div class="col-md-8  col-sm-8 col-xs-8  blg-entry">
                                    <h6> <a href="detail.html">番禺区笋盘 </a></h6> 
                                    <p style="line-height: 17px; padding: 8px 2px;">棒棒哒的房子 棒棒哒</p>
                                </div>
                            </li> 

                            <li>
                                <div class="col-md-4 col-sm-4 col-xs-4 blg-thumb p0">
                                    <a href="detail.html">
                                        <img src="pic/small-pic.jpg">
                                    </a>
                                    <span class="blg-date">12-12-2019</span>

                                </div>
                                <div class="col-md-8  col-sm-8 col-xs-8  blg-entry">
                                    <h6> <a href="detail.html">番禺区笋盘 </a></h6> 
                                    <p style="line-height: 17px; padding: 8px 2px;">棒棒哒的房子 棒棒哒</p>
                                </div>
                            </li> 


                        </ul>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 wow fadeInRight animated animated" style="visibility: visible; animation-name: fadeInRight;">
                    <div class="single-footer news-letter">
                        <h4>反馈＆分享</h4>
                        <div class="footer-title-line"></div>
                        <p>亲们，可以在此留下你们的意见＆建议~</p>

                        <form>
                            <div class="input-group">
                                <input class="form-control" type="text" placeholder="E-mail ... ">
                                <span class="input-group-btn">
                                    <button class="btn btn-primary subscribe" type="button">
                                        <i class="pe-7s-paper-plane pe-2x"></i>
                                    </button>
                                </span>
                            </div>
                            <!-- /input-group -->
                        </form> 

                        <div class="social pull-right"> 
                            <ul>
                                <li>
                                    <a class="wow fadeInUp animated animated" href="https://twitter.com/kimarotec" style="visibility: visible; animation-name: fadeInUp;">
                                        <i class="fa fa-twitter"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="wow fadeInUp animated animated" href="https://www.facebook.com/kimarotec" data-wow-delay="0.2s" style="visibility: visible; animation-delay: 0.2s; animation-name: fadeInUp;">
                                        <i class="fa fa-facebook"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="wow fadeInUp animated animated" href="https://plus.google.com/kimarotec" data-wow-delay="0.3s" style="visibility: visible; animation-delay: 0.3s; animation-name: fadeInUp;">
                                        <i class="fa fa-google-plus"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="wow fadeInUp animated animated" href="https://instagram.com/kimarotec" data-wow-delay="0.4s" style="visibility: visible; animation-delay: 0.4s; animation-name: fadeInUp;">
                                        <i class="fa fa-instagram"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="wow fadeInUp animated animated" href="https://instagram.com/kimarotec" data-wow-delay="0.6s" style="visibility: visible; animation-delay: 0.6s; animation-name: fadeInUp;">
                                        <i class="fa fa-dribbble"></i>
                                    </a>
                                </li>
                            </ul> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="./img/common.css">
<script src="./js/business/toast.js"></script>

<!-- 请求后端数据接口 -->
<script>
$(document).ready(() => {

		$('#toSearch').click(() => { window.location.href = 'search.html' })
		$('#qaNavSearcherIpt').focus(() => { window.location.href = 'search.html' })

		const userInfo = JSON.parse(sessionStorage.getItem('user'))
		console.log(userInfo, 'userInfo')
		$('.userinfo').css({ 'display': 'none' })
		$('.exit').css({ 'display': 'none' })
		if (userInfo) { // 如果用户存在展示用户信息，调整样式
			$('.login').css('display', 'none')
			$('.registry').css('display', 'none')
			$('.userinfo').text(`欢迎您：${userInfo.username}`)
			$('.exit').text(`退出`)
			$('.userinfo').css({ 'display': 'flex', 'white-space': 'nowrap', 'margin-right': '30px', 'width': 'auto', 'cursor': 'pointer' })
			$('.exit').css({ 'display': 'flex', 'align-items': 'center', 'cursor': 'pointer','white-space': 'nowrap',  'font-size': '14px', 'color': '#777' })
			$('.ul_son').css({ 'display': 'flex', 'align-items': 'center' })
			$('.userinfo').click(() => {
				window.location.href = 'personal-infor.html'
			})
		}


	const user = JSON.parse(sessionStorage.getItem('user'))
	if (!user ) return $.toast.fail('请先登录')
	const _id = getUrlParam('houseID')
	console.log(_id, 'id')
	$.ajax({ // 根据id查询房子信息
		type: 'GET',
		url: `http://localhost:3000/api/house/${_id}`,
		success(res) {
			console.log(res, '请求房源信息')
			sessionStorage.setItem('house', JSON.stringify(res))
			$('#houseTitle').text(res.title)
			$('#housePrice').text(res.price)
			$('#houseStatus').text(res.status)
			$('#houseArea').text(res.area)
			$('#romeNum').text(res.romeNum)
			$('#livingRoomNum').text(res.livingRoomNum)
			$('#toiletNum').text(res.toiletNum)
			$('#saleSituation').text(res.saleSituation)
			$('#garden').text(res.garden ? '是' : '否')
			$('#houseDesc').text(res.add)
			// 房子图片
			res.avatar.forEach((item, index) => {
				$(`.sp${index}`).attr('src', item)
				$(`.img${index}`).attr('src', item)
			})
			// 拥有特点 内容替换
			res.feature.split('，').forEach(item => {
				$('#houseFeature').append(`
					<li><a href="#">${ item }</a></li>
				`)
			})
			// 卖点 内容替换
			res.sellingPoint.split('；').forEach(item => {
				$('#lanlordSelling').append(`
					<li>
						<span class="col-xs-6 col-sm-4 col-md-4 add-d-title">${ item.split('：')[0] }</span>
						<span class="col-xs-6 col-sm-8 col-md-8 add-d-entry">${ item.split('：')[1] }</span>
					</li>
				`)
			})
			$.ajax({ // 请求的房子的房东信息
				type: 'GET',
				url: `http://localhost:3000/api/users/${res.userID}`,
				success(res) {
					if(res.message) return $.toast.info(res.message)
					$('#lanlordAvatar').attr('src', res.avatar)
					$('#landlordName').text(res.username)
					$('#lanlordAddr').text(res.address)
					$('#lanlordEmail').text(res.email)
					$('#lanlordPhone').text(res.phone)
					$('#lanlordDesc').text(res.userDesc)
					console.log(res, '房东信息')
				},
				error(err) {
					$.toast.info(`${err.status} ${err.statusText}`)
					console.log(err)
				}
			})

			if (!res.commentID) return $('#pagination').css('display', 'none')

			$.ajax({ // 请求房子的评论信息
				type: 'GET',
				url: `http://localhost:3000/api/comment/${res.commentID}`,
				success(res) {
					console.log(res, '请求评论信息')
					$('#noResult').css('display', 'none')
					$('#titleInputNode').val('')
					res.forEach(item => {
						$.ajax({
							type: 'GET',
							url: `http://localhost:3000/api/users/${item.userID}`,
							success(user) {
								console.log(user, 'res')
								$('#commentWrap').append(`
									<div class="comment-wrap">
										<div class="avater_content">
											<img src="${user.avatarUrl ? user.avatarUrl : user.avatar}" alt="无法加载图片" class="pinglun_img">
											<span  class="pinglun_name">${user.username}</span>
										</div>
										<div class="r_content">
												<span class="pinglun_main">${item.comment}</span>
												<span class="pinglun_time">${ item.publishTime }</span>
										</div>
									</div>
								`)
							},
							error(err) {
								$.toast.fail('查询用户信息失败')
							}
						})
					})
				},
				error(err) {
					console.log(err, '请求房子的评论信息')
				}
			})
		},
		error(err) {
			if(err) $.toast.fail(`${err.status} ${err.statusText}`)
			console.log(err, 'err')
		}
	})
})


function submitComment() { // 提交评论
	const user = JSON.parse(sessionStorage.getItem('user'))
	if (!user) return $.toast.fail('请先登录')
	const comment = $('#titleInputNode').val()
	if(!comment) return $.toast.fail('输入内容不能空')
	const data = JSON.stringify({ userID: user._id, comment, houseID: getUrlParam('houseID'), publishTime: new Date().toLocaleString() })
	$.ajax({ // 新增评论
		type: 'POST',
		data: data,
		contentType: 'application/json; charset=utf-8',
    dataType: 'json',
		url: 'http://localhost:3000/api/comment',
		success(res) {
			$('#noResult').css('display', 'none')
			$('#titleInputNode').val('')
			$.ajax({ // 更新房子信息，房子信息与评论id进行绑定
				type: 'POST',
				contentType: 'application/json; charset=utf-8',
    		dataType: 'json',
				data:  JSON.stringify({ commentID: res._id, houseID: getUrlParam('houseID') }),
				url: `http:localhost:3000/api/house/update`,
				success(res) {
					console.log(res, 'update house')
				},
				error(err) {
					$.toast.fail(`${err.status} ${err.statusText}`)
				}
			})
			res && $('#commentWrap').prepend(`
				<div class="comment-wrap">
					<div class="avater_content">
						<img src="${user.avatarUrl ? user.avatarUrl : user.avatar}" alt="无法加载图片" class="pinglun_img">
						<span  class="pinglun_name">${user.username}</span>
					</div>
					<div class="r_content">
							<span class="pinglun_main">${res.comment}</span>
							<span class="pinglun_time">${ res.publishTime }</span>
					</div>
				</div>
			`)
			console.log(res, 'res')
		},
		error(err) {
			$.toast.fail(`评论失败，请求状态码为${err.status} ${ err.statusText }`)
			console.log(err, 'err')
		}
	})
}

function getUrlParam(name) { // 获取url参数
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
		var r = window.location.search.substr(1).match(reg);  //匹配目标参数
		if (r != null) return unescape(r[2]); return null; //返回参数值
	}

</script>


<!-- 轮播图的JS -->
<script type="text/javascript"> 
	$( document ).ready(function( $ ) {
    $( '#my-slider' ).sliderPro();
  }); 

	FluentRevealEffect.applyEffect(".btn", {
	  lightColor: "rgba(255,255,255,0.1)",
	  gradientSize: 150
	}) 
</script>

<script type="text/javascript" src="js/bootsnav.js"></script> 
<!-- 百度地图JS插件 -->
<!-- 接口js地址 -->
<script type="text/javascript" src="http://api.map.baidu.com/api?key=&v=1.1&services=true"></script>
<script type="text/javascript" src="js/baidumap.js"></script>
</body>
</html>